[gd_scene load_steps=27 format=3 uid="uid://btlbjw8y0rbta"]

[ext_resource type="PackedScene" uid="uid://cvqrsab0cofjc" path="res://scenes/enemies/enemy.tscn" id="1_wanvk"]
[ext_resource type="Script" path="res://scripts/classes/basic_enemies/enemy_body_stompable_3d.gd" id="2_pt0it"]
[ext_resource type="Script" path="res://scripts/data/dropable.gd" id="3_7l78g"]
[ext_resource type="Script" path="res://scripts/classes/basic_enemies/stompable_3d.gd" id="3_8jjjj"]
[ext_resource type="Script" path="res://scripts/classes/scalable_3d.gd" id="4_s6xaw"]
[ext_resource type="Script" path="res://scripts/classes/grabables/grabable_rigid_3d.gd" id="5_34fwr"]
[ext_resource type="PackedScene" uid="uid://dutnoet18jlv1" path="res://scenes/props/interactuable.tscn" id="6_03ebh"]
[ext_resource type="Script" path="res://scripts/classes/player_detect_area_3d.gd" id="6_4jrmr"]
[ext_resource type="PackedScene" uid="uid://bsixki37vnhl" path="res://art/3D/models/chickenV2.glb" id="6_hc3a3"]
[ext_resource type="Script" path="res://scripts/classes/collision_shape_scalable_3d.gd" id="7_cnhxo"]

[sub_resource type="Resource" id="Resource_2mlj6"]
script = ExtResource("3_7l78g")
chance = 1

[sub_resource type="GDScript" id="GDScript_30s5s"]
script/source = "extends RigidBody3D

var explodable : bool = false
var explosion : PackedScene = preload(\"res://scenes/particle_effects/explosion.tscn\")
var exploded : bool = false

func _process(delta: float) -> void:
	explodable = ($Scalable3D as Scalable3D).current_scale.x <= 0.6
	
func explode() -> void:
	if(exploded) : return
	
	$ExplodeArea/CollisionShape3D.disabled = false
	var r_tween : Tween = get_tree().create_tween()
	r_tween.tween_property(($ExplodeArea/CollisionShape3D.shape as SphereShape3D), \"radius\", 8.8, 0.5)
	exploded = true
	var inst : GPUParticlesIPOS3D = explosion.instantiate()
	freeze = true
	inertia = Vector3.ZERO
	get_parent().add_child(inst)
	inst.global_transform.origin = global_transform.origin
	$Mesh.visible = false
	await(get_tree().create_timer(1.0).timeout)
	queue_free()
	
func _on_area_3d_body_entered(body: Node3D) -> void:
	if(explodable and ($GrabableRigid3D as GrabableRigid3D).player == null and Utils.find_custom_nodes(body, \"res://scripts/classes/basic_enemies/stompable_3d.gd\").size() > 0):
		explode()

func _on_explode_area_body_entered(body: Node3D) -> void:
	if(($GrabableRigid3D as GrabableRigid3D).player == null and Utils.find_custom_nodes(body, \"res://scripts/classes/basic_enemies/stompable_3d.gd\").size() > 0):
		(body as EnemyBody3D).stompable.stomp()
"

[sub_resource type="SphereShape3D" id="SphereShape3D_celin"]
radius = 2.53683

[sub_resource type="SphereShape3D" id="SphereShape3D_xqxxk"]
radius = 1.0

[sub_resource type="SphereShape3D" id="SphereShape3D_yxw3d"]
radius = 1.08121

[sub_resource type="SphereMesh" id="SphereMesh_tmof0"]
radius = 1.0
height = 2.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_padjq"]
albedo_color = Color(0, 0, 0, 1)

[sub_resource type="Shader" id="Shader_rlu5u"]
code = "shader_type spatial;
render_mode cull_front, unshaded;

uniform vec4 outline_color : source_color;
uniform float outline_width = 1.0;

void vertex() {
	vec4 clip_position = PROJECTION_MATRIX * (MODELVIEW_MATRIX * vec4(VERTEX, 1.0));
	vec3 clip_normal = mat3(PROJECTION_MATRIX) * (mat3(MODELVIEW_MATRIX) * NORMAL);
	
	vec2 offset = normalize(clip_normal.xy) / VIEWPORT_SIZE * clip_position.w * outline_width * 2.0;
	
	clip_position.xy += offset;
	
	POSITION = clip_position;
}

void fragment() {
	ALBEDO = outline_color.rgb;
	if (outline_color.a < 1.0) {
		ALPHA = outline_color.a;
	}
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_doskr"]
render_priority = 0
next_pass = SubResource("StandardMaterial3D_padjq")
shader = SubResource("Shader_rlu5u")
shader_parameter/outline_color = Color(0, 1, 0, 1)
shader_parameter/outline_width = 0.0

[sub_resource type="CylinderMesh" id="CylinderMesh_uoq4d"]
top_radius = 0.25
bottom_radius = 0.25
height = 0.25

[sub_resource type="CylinderMesh" id="CylinderMesh_eyk1w"]
top_radius = 0.1
bottom_radius = 0.1
height = 0.25

[sub_resource type="SphereShape3D" id="SphereShape3D_p1wkv"]
radius = 0.001

[sub_resource type="PackedScene" id="PackedScene_dvic1"]
_bundled = {
"conn_count": 2,
"conns": PackedInt32Array(6, 0, 31, 30, 2, 0, 0, 12, 0, 31, 32, 2, 0, 0),
"editable_instances": [],
"names": PackedStringArray("Bomb", "script", "RigidBody3D", "Scalable3D", "root", "max_scale", "Node", "GrabableRigid3D", "item", "interactuable", "Interactuable", "show_interaction_sprite", "highlight_mesh", "interaction_color", "CollisionShape3D", "shape", "CollisionShapeScalable3D", "scalable_3d", "optional_extra_scaling", "Area3D", "Mesh", "Node3D", "MeshInstance3D", "mesh", "skeleton", "surface_material_override/0", "MeshInstance3D2", "transform", "MeshInstance3D3", "ExplodeArea", "_on_area_3d_body_entered", "body_entered", "_on_explode_area_body_entered"),
"node_count": 14,
"node_paths": [],
"nodes": PackedInt32Array(-1, -1, 2, 0, -1, 1, 1, 0, 0, 0, 0, 6, 3, -1, 3, 1, 1, 1073741828, 2, 5, 3, 0, 0, 0, 6, 7, -1, 3, 1, 4, 1073741832, 2, 1073741833, 5, 0, 0, 0, 2147483647, 10, 6, 3, 11, 7, 1073741836, 8, 13, 9, 0, 3, 0, 14, 14, -1, 1, 15, 10, 0, 0, 0, 14, 16, -1, 4, 15, 11, 1, 12, 1073741841, 13, 18, 14, 0, 0, 0, 19, 19, -1, 0, 0, 6, 0, 14, 14, -1, 1, 15, 15, 0, 0, 0, 21, 20, -1, 0, 0, 8, 0, 22, 22, -1, 3, 23, 16, 24, 17, 25, 18, 0, 8, 0, 22, 26, -1, 4, 27, 19, 23, 20, 24, 17, 25, 18, 0, 8, 0, 22, 28, -1, 4, 27, 21, 23, 22, 24, 17, 25, 18, 0, 0, 0, 19, 29, -1, 0, 0, 12, 0, 14, 14, -1, 1, 15, 23, 0),
"variants": [SubResource("GDScript_30s5s"), ExtResource("4_s6xaw"), NodePath(".."), 1.2, ExtResource("5_34fwr"), NodePath("../Interactuable"), ExtResource("6_03ebh"), false, NodePath("../Mesh/MeshInstance3D"), Color(0, 1, 0, 1), SubResource("SphereShape3D_celin"), SubResource("SphereShape3D_xqxxk"), ExtResource("7_cnhxo"), NodePath("../Scalable3D"), 2.0, SubResource("SphereShape3D_yxw3d"), SubResource("SphereMesh_tmof0"), NodePath("../.."), SubResource("ShaderMaterial_doskr"), Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.894666, 0), SubResource("CylinderMesh_uoq4d"), Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.13796, 0), SubResource("CylinderMesh_eyk1w"), SubResource("SphereShape3D_p1wkv")],
"version": 3
}

[sub_resource type="Resource" id="Resource_mr6wd"]
script = ExtResource("3_7l78g")
drop = SubResource("PackedScene_dvic1")
chance = 1

[sub_resource type="BoxShape3D" id="BoxShape3D_4rmbh"]
size = Vector3(2, 2, 2)

[sub_resource type="BoxShape3D" id="BoxShape3D_cmi2g"]
size = Vector3(2.38513, 2.37923, 2.44417)

[node name="EnemyStompDrop" node_paths=PackedStringArray("stompable", "collision_shape", "player_detect_area") instance=ExtResource("1_wanvk")]
script = ExtResource("2_pt0it")
drops = Array[ExtResource("3_7l78g")]([SubResource("Resource_2mlj6"), SubResource("Resource_mr6wd")])
stompable = NodePath("Stompable3D")
collision_shape = NodePath("CollisionShape3D")
player_detect_area = NodePath("PlayerDetectArea3D")

[node name="Stompable3D" type="Node3D" parent="." index="0" node_paths=PackedStringArray("enemy", "player_detector")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.99307, 0)
script = ExtResource("3_8jjjj")
enemy = NodePath("..")
player_detector = NodePath("../PlayerDetectArea3D")

[node name="CollisionShape3D" type="CollisionShape3D" parent="." index="1"]
shape = SubResource("BoxShape3D_4rmbh")

[node name="chickenV2" parent="Mesh" index="0" instance=ExtResource("6_hc3a3")]
transform = Transform3D(-6.77527e-09, 0, 0.155, 0, 0.155, 0, -0.155, 0, -6.77527e-09, 0, -0.988553, 0)

[node name="PlayerDetectArea3D" type="Area3D" parent="." index="5"]
script = ExtResource("6_4jrmr")

[node name="CollisionShape3D" type="CollisionShape3D" parent="PlayerDetectArea3D" index="0"]
shape = SubResource("BoxShape3D_cmi2g")
